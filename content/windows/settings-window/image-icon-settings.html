<script src="content/scripts/utilities.js"></script>
<article role="tabpanel" id="image-icon-settings">
    <fieldset id="wallpaper-settings">
        <legend>Select a wallpaper</legend>
    </fieldset>
    <fieldset id="favicon-settings">
        <legend>Select a favicon</legend>
    </fieldset>
</article>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Async function to fetch and append configuration data
    async function loadConfigAndAppend() {
        try {
            console.log('Fetching configuration from:', 'content/jsonLists/configOptions.json');
            const response = await fetch('content/jsonLists/configOptions.json');

            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            console.log('Configuration data loaded:', data);

            // Append wallpapers
            const wallpaperSettings = document.getElementById('wallpaper-settings');
            data.wallpapers.forEach((wallpaper, index) => {
                const div = document.createElement('div');
                div.className = 'field-row';
                div.innerHTML = `
                    <input id="wallpaperoption${index + 1}" type="radio" name="wallpaperselect" value="${wallpaper.value}" onclick="applyWallpaper(this.value)" ${index === 0 ? 'checked' : ''}>
                    <label for="wallpaperoption${index + 1}">${wallpaper.label}</label>
                `;
                wallpaperSettings.appendChild(div);
            });

            // Append favicons
            const faviconSettings = document.getElementById('favicon-settings');
            data.favicons.forEach((favicon, index) => {
                const div = document.createElement('div');
                div.className = 'field-row';
                div.innerHTML = `
                    <input id="faviconOption${index + 1}" type="radio" name="faviconSelect" value="${favicon.value}" onclick="applyFavicon(this.value)" ${index === 0 ? 'checked' : ''}>
                    <label for="faviconOption${index + 1}">
                        <img src="${favicon.icon}" alt="${favicon.label}">
                    </label>
                `;
                faviconSettings.appendChild(div);
            });

            // Apply saved settings
            applySavedSelections();

        } catch (error) {
            console.error('Error loading configuration:', error);
        }
    }

    // Helper function to apply saved selections
    function applySavedSelections() {
        const savedWallpaper = loadFromLocalStorage('selectedWallpaper');
        console.log('Saved wallpaper selection:', savedWallpaper);
        if (savedWallpaper) {
            const wallpaperInput = document.querySelector(`input[value="${savedWallpaper}"][name="wallpaperselect"]`);
            if (wallpaperInput) {
                wallpaperInput.checked = true;
            }
        }

        const savedFavicon = loadFromLocalStorage('selectedFavicon');
        console.log('Saved favicon selection:', savedFavicon);
        if (savedFavicon) {
            const faviconInput = document.querySelector(`input[value="${savedFavicon}"][name="faviconSelect"]`);
            if (faviconInput) {
                faviconInput.checked = true;
            }
        }
    }

    // Call the async function
    loadConfigAndAppend();
});

</script>